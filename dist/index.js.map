{"version":3,"sources":["../src/data/crawlers.ts","../src/middleware/ai-detector.ts","../src/generators/robots-generator.ts","../src/generators/llms-generator.ts","../src/schema/schema-builder.ts","../src/analyzer/content-analyzer.ts","../src/monitor/visitor-logger.ts"],"names":["path","cheerio","cheerio2","fs"],"mappings":"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","file":"index.js","sourcesContent":["// ============================================================\r\n// Known AI Crawlers Database\r\n// Kept in one place so all modules share the same source of truth\r\n// ============================================================\r\n\r\nimport type { BotInfo } from '../types'\r\n\r\nexport const AI_CRAWLERS: BotInfo[] = [\r\n    {\r\n        name: 'GPTBot',\r\n        company: 'OpenAI',\r\n        userAgentPattern: 'gptbot',\r\n        purpose: 'training',\r\n    },\r\n    {\r\n        name: 'ChatGPT-User',\r\n        company: 'OpenAI',\r\n        userAgentPattern: 'chatgpt-user',\r\n        purpose: 'search',\r\n    },\r\n    {\r\n        name: 'ClaudeBot',\r\n        company: 'Anthropic',\r\n        userAgentPattern: 'claudebot',\r\n        purpose: 'training',\r\n    },\r\n    {\r\n        name: 'Claude-Web',\r\n        company: 'Anthropic',\r\n        userAgentPattern: 'claude-web',\r\n        purpose: 'search',\r\n    },\r\n    {\r\n        name: 'PerplexityBot',\r\n        company: 'Perplexity AI',\r\n        userAgentPattern: 'perplexitybot',\r\n        purpose: 'search',\r\n    },\r\n    {\r\n        name: 'Google-Extended',\r\n        company: 'Google',\r\n        userAgentPattern: 'google-extended',\r\n        purpose: 'training',\r\n    },\r\n    {\r\n        name: 'Googlebot',\r\n        company: 'Google',\r\n        userAgentPattern: 'googlebot',\r\n        purpose: 'indexing',\r\n    },\r\n    {\r\n        name: 'Bingbot',\r\n        company: 'Microsoft',\r\n        userAgentPattern: 'bingbot',\r\n        purpose: 'indexing',\r\n    },\r\n    {\r\n        name: 'CCBot',\r\n        company: 'Common Crawl',\r\n        userAgentPattern: 'ccbot',\r\n        purpose: 'training',\r\n    },\r\n    {\r\n        name: 'YouBot',\r\n        company: 'You.com',\r\n        userAgentPattern: 'youbot',\r\n        purpose: 'search',\r\n    },\r\n    {\r\n        name: 'cohere-ai',\r\n        company: 'Cohere',\r\n        userAgentPattern: 'cohere-ai',\r\n        purpose: 'training',\r\n    },\r\n    {\r\n        name: 'meta-externalagent',\r\n        company: 'Meta',\r\n        userAgentPattern: 'meta-externalagent',\r\n        purpose: 'training',\r\n    },\r\n    {\r\n        name: 'Applebot-Extended',\r\n        company: 'Apple',\r\n        userAgentPattern: 'applebot-extended',\r\n        purpose: 'training',\r\n    },\r\n    {\r\n        name: 'Diffbot',\r\n        company: 'Diffbot',\r\n        userAgentPattern: 'diffbot',\r\n        purpose: 'indexing',\r\n    },\r\n    {\r\n        name: 'Bytespider',\r\n        company: 'ByteDance',\r\n        userAgentPattern: 'bytespider',\r\n        purpose: 'training',\r\n    },\r\n]\r\n\r\n/**\r\n * Detect which AI bot is making the request based on User-Agent string.\r\n * Returns the BotInfo if matched, null otherwise.\r\n */\r\nexport function detectBot(userAgent: string): BotInfo | null {\r\n    if (!userAgent) return null\r\n    const ua = userAgent.toLowerCase()\r\n    return AI_CRAWLERS.find((bot) => ua.includes(bot.userAgentPattern)) ?? null\r\n}\r\n\r\n/**\r\n * Get all known bot names (for robots.txt generation, etc.)\r\n */\r\nexport function getAllBotNames(): string[] {\r\n    return AI_CRAWLERS.map((b) => b.name)\r\n}\r\n\r\n/**\r\n * Get bots by purpose\r\n */\r\nexport function getBotsByPurpose(\r\n    purpose: BotInfo['purpose']\r\n): BotInfo[] {\r\n    return AI_CRAWLERS.filter((b) => b.purpose === purpose)\r\n}\r\n","// ============================================================\r\n// AI Bot Detector & Middleware\r\n// Feature 1: Detect AI crawlers and serve them optimized HTML\r\n// ============================================================\r\n\r\nimport type { Request, Response, NextFunction } from 'express'\r\nimport { detectBot, AI_CRAWLERS } from '../data/crawlers'\r\nimport type { AIMiddlewareConfig, AIOptimizationOptions, BotInfo } from '../types'\r\n\r\n// ---- HTML Optimizer ----\r\n\r\n/**\r\n * Strips non-essential content from HTML for AI crawler consumption.\r\n * Keeps semantic structure, JSON-LD schema, and meaningful text.\r\n */\r\nexport class HTMLOptimizer {\r\n    private options: Required<AIOptimizationOptions>\r\n\r\n    constructor(options: AIOptimizationOptions = {}) {\r\n        this.options = {\r\n            stripJs: options.stripJs ?? true,\r\n            removeAds: options.removeAds ?? true,\r\n            removeTracking: options.removeTracking ?? true,\r\n            simplifyNav: options.simplifyNav ?? false,\r\n            structureContent: options.structureContent ?? true,\r\n        }\r\n    }\r\n\r\n    optimize(html: string): string {\r\n        let result = html\r\n\r\n        if (this.options.stripJs) {\r\n            // Remove all <script> tags EXCEPT JSON-LD schema blocks\r\n            result = result.replace(\r\n                /<script(?![^>]*type=[\"']application\\/ld\\+json[\"'])[^>]*>[\\s\\S]*?<\\/script>/gi,\r\n                ''\r\n            )\r\n            // Remove inline event handlers\r\n            result = result.replace(/\\s+on\\w+=\"[^\"]*\"/gi, '')\r\n            result = result.replace(/\\s+on\\w+='[^']*'/gi, '')\r\n        }\r\n\r\n        if (this.options.removeTracking) {\r\n            // Remove tracking pixels (1x1 images)\r\n            result = result.replace(\r\n                /<img[^>]*(?:width=[\"']1[\"'][^>]*height=[\"']1[\"']|height=[\"']1[\"'][^>]*width=[\"']1[\"'])[^>]*\\/?>/gi,\r\n                ''\r\n            )\r\n            // Remove common analytics/tracking script patterns\r\n            result = result.replace(\r\n                /<noscript>[^<]*(?:google-analytics|gtm|facebook|pixel)[^<]*<\\/noscript>/gi,\r\n                ''\r\n            )\r\n            // Remove <link> preconnect to tracking domains\r\n            result = result.replace(\r\n                /<link[^>]*(?:google-analytics|doubleclick|facebook\\.net)[^>]*>/gi,\r\n                ''\r\n            )\r\n        }\r\n\r\n        if (this.options.removeAds) {\r\n            // Remove elements with common ad class/id patterns\r\n            result = result.replace(\r\n                /<[^>]+(?:class|id)=[\"'][^\"']*(?:ad-|ads-|advertisement|banner-ad|sponsored)[^\"']*[\"'][^>]*>[\\s\\S]*?<\\/\\w+>/gi,\r\n                ''\r\n            )\r\n            // Remove <ins> tags (Google AdSense)\r\n            result = result.replace(/<ins\\b[^>]*>[\\s\\S]*?<\\/ins>/gi, '')\r\n        }\r\n\r\n        if (this.options.simplifyNav) {\r\n            // Replace <nav> with a simplified version (just links)\r\n            result = result.replace(/<nav[^>]*>([\\s\\S]*?)<\\/nav>/gi, (_, inner) => {\r\n                const links = inner.match(/<a[^>]*href=\"([^\"]*)\"[^>]*>([^<]*)<\\/a>/gi) || []\r\n                return `<nav>${links.join(' | ')}</nav>`\r\n            })\r\n        }\r\n\r\n        // Add AI-friendly meta comment\r\n        result = result.replace(\r\n            '<head>',\r\n            '<head>\\n  <!-- Optimized for AI crawlers by ai-visibility -->'\r\n        )\r\n\r\n        return result\r\n    }\r\n}\r\n\r\n// ---- Bot Detector Class ----\r\n\r\nexport class AIBotDetector {\r\n    private additionalBots: string[]\r\n    private ignoreBots: Set<string>\r\n\r\n    constructor(config: Pick<AIMiddlewareConfig, 'additionalBots' | 'ignoreBots'> = {}) {\r\n        this.additionalBots = config.additionalBots ?? []\r\n        this.ignoreBots = new Set(\r\n            (config.ignoreBots ?? []).map((b) => b.toLowerCase())\r\n        )\r\n    }\r\n\r\n    /**\r\n     * Detect if the given User-Agent belongs to an AI crawler.\r\n     * Returns BotInfo if detected, null otherwise.\r\n     */\r\n    detect(userAgent: string): BotInfo | null {\r\n        if (!userAgent) return null\r\n\r\n        // Check against known crawlers\r\n        const known = detectBot(userAgent)\r\n        if (known && !this.ignoreBots.has(known.userAgentPattern)) {\r\n            return known\r\n        }\r\n\r\n        // Check additional custom bots\r\n        const ua = userAgent.toLowerCase()\r\n        for (const pattern of this.additionalBots) {\r\n            if (ua.includes(pattern.toLowerCase()) && !this.ignoreBots.has(pattern.toLowerCase())) {\r\n                return {\r\n                    name: pattern,\r\n                    company: 'Unknown',\r\n                    userAgentPattern: pattern.toLowerCase(),\r\n                    purpose: 'unknown',\r\n                }\r\n            }\r\n        }\r\n\r\n        return null\r\n    }\r\n\r\n    /** Get all tracked bot names */\r\n    getBotNames(): string[] {\r\n        return [\r\n            ...AI_CRAWLERS.map((b) => b.name),\r\n            ...this.additionalBots,\r\n        ]\r\n    }\r\n}\r\n\r\n// ---- Express Middleware ----\r\n\r\n/**\r\n * createAIMiddleware\r\n *\r\n * Detects AI crawlers and attaches bot info to the request object.\r\n * Combine with optimizeResponseForAI() to serve optimized HTML.\r\n *\r\n * @example\r\n * ```ts\r\n * import express from 'express'\r\n * import { createAIMiddleware, optimizeResponseForAI } from 'ai-visibility'\r\n *\r\n * const app = express()\r\n * app.use(createAIMiddleware())\r\n * app.use(optimizeResponseForAI())\r\n * ```\r\n */\r\nexport function createAIMiddleware(config: AIMiddlewareConfig = {}) {\r\n    const detector = new AIBotDetector(config)\r\n    const verbose = config.verbose ?? false\r\n\r\n    return function aiDetectorMiddleware(\r\n        req: Request,\r\n        _res: Response,\r\n        next: NextFunction\r\n    ): void {\r\n        const userAgent = req.headers['user-agent'] ?? ''\r\n        const botInfo = detector.detect(userAgent)\r\n\r\n        if (botInfo) {\r\n            req.isAIBot = true\r\n            req.aiBotInfo = botInfo\r\n\r\n            if (verbose) {\r\n                console.log(\r\n                    `[ai-visibility]  ${botInfo.name} (${botInfo.company}) detected  ${req.method} ${req.url}`\r\n                )\r\n            }\r\n        }\r\n\r\n        next()\r\n    }\r\n}\r\n\r\n/**\r\n * optimizeResponseForAI\r\n *\r\n * Intercepts HTML responses for AI bots and strips unnecessary content.\r\n * Must be used AFTER createAIMiddleware().\r\n *\r\n * @example\r\n * ```ts\r\n * app.use(createAIMiddleware())\r\n * app.use(optimizeResponseForAI({ stripJs: true, removeAds: true }))\r\n * ```\r\n */\r\nexport function optimizeResponseForAI(options: AIOptimizationOptions = {}) {\r\n    const optimizer = new HTMLOptimizer(options)\r\n\r\n    return function aiOptimizeMiddleware(\r\n        req: Request,\r\n        res: Response,\r\n        next: NextFunction\r\n    ): void {\r\n        if (!req.isAIBot) {\r\n            next()\r\n            return\r\n        }\r\n\r\n        // Monkey-patch res.send to intercept HTML responses\r\n        const originalSend = res.send.bind(res) as (body?: unknown) => Response\r\n\r\n        res.send = function (body?: unknown): Response {\r\n            if (\r\n                typeof body === 'string' &&\r\n                body.includes('<html') &&\r\n                (res.getHeader('content-type') as string | undefined)\r\n                    ?.includes('text/html') !== false\r\n            ) {\r\n                body = optimizer.optimize(body)\r\n            }\r\n            return originalSend(body)\r\n        }\r\n\r\n        next()\r\n    }\r\n}\r\n","// ============================================================\r\n// robots.txt Generator\r\n// Feature 2a: Auto-generate AI-optimized robots.txt\r\n// ============================================================\r\n\r\nimport type { RobotsConfig } from '../types'\r\nimport { AI_CRAWLERS } from '../data/crawlers'\r\n\r\nconst DEFAULT_DISALLOW = ['/admin', '/api', '/private', '/_next', '/static']\r\n\r\n/**\r\n * RobotsGenerator\r\n *\r\n * Generates a robots.txt file that explicitly allows AI crawlers\r\n * and optionally blocks specific ones (e.g., training bots).\r\n *\r\n * @example\r\n * ```ts\r\n * import { RobotsGenerator } from 'ai-visibility'\r\n * import fs from 'fs'\r\n *\r\n * const gen = new RobotsGenerator({\r\n *   allowAI: ['GPTBot', 'ClaudeBot', 'PerplexityBot'],\r\n *   blockAI: ['CCBot'],\r\n *   disallow: ['/admin', '/api'],\r\n *   sitemapUrl: 'https://mysite.com/sitemap.xml',\r\n * })\r\n *\r\n * fs.writeFileSync('./public/robots.txt', gen.generate())\r\n * ```\r\n */\r\nexport class RobotsGenerator {\r\n    private config: Required<RobotsConfig>\r\n\r\n    constructor(config: RobotsConfig = {}) {\r\n        // Default: allow all known AI crawlers\r\n        const allBotNames = AI_CRAWLERS.map((b) => b.name)\r\n\r\n        this.config = {\r\n            allowAI: config.allowAI ?? allBotNames,\r\n            blockAI: config.blockAI ?? [],\r\n            disallow: config.disallow ?? DEFAULT_DISALLOW,\r\n            sitemapUrl: config.sitemapUrl ?? '',\r\n            crawlDelay: config.crawlDelay ?? 0,\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Generate the robots.txt content as a string.\r\n     */\r\n    generate(): string {\r\n        const lines: string[] = []\r\n\r\n        lines.push('# robots.txt  Generated by ai-visibility')\r\n        lines.push('# https://github.com/yourusername/ai-visibility')\r\n        lines.push('')\r\n\r\n        // Blocked AI crawlers first\r\n        if (this.config.blockAI.length > 0) {\r\n            lines.push('# Blocked AI crawlers (training opt-out)')\r\n            for (const bot of this.config.blockAI) {\r\n                lines.push(`User-agent: ${bot}`)\r\n                lines.push('Disallow: /')\r\n                lines.push('')\r\n            }\r\n        }\r\n\r\n        // Allowed AI crawlers\r\n        const allowedBots = this.config.allowAI.filter(\r\n            (b) => !this.config.blockAI.includes(b)\r\n        )\r\n\r\n        if (allowedBots.length > 0) {\r\n            lines.push('# AI crawlers  explicitly allowed')\r\n            for (const bot of allowedBots) {\r\n                lines.push(`User-agent: ${bot}`)\r\n                lines.push('Allow: /')\r\n                if (this.config.crawlDelay > 0) {\r\n                    lines.push(`Crawl-delay: ${this.config.crawlDelay}`)\r\n                }\r\n                lines.push('')\r\n            }\r\n        }\r\n\r\n        // Default rules for all other bots\r\n        lines.push('# Default rules')\r\n        lines.push('User-agent: *')\r\n        for (const path of this.config.disallow) {\r\n            lines.push(`Disallow: ${path}`)\r\n        }\r\n        lines.push('')\r\n\r\n        // Sitemap\r\n        if (this.config.sitemapUrl) {\r\n            lines.push(`Sitemap: ${this.config.sitemapUrl}`)\r\n        }\r\n\r\n        return lines.join('\\n')\r\n    }\r\n\r\n    /**\r\n     * Returns a pre-built robots.txt that allows ALL known AI crawlers.\r\n     * Good for quick setup with zero configuration.\r\n     */\r\n    static allowAll(options: Partial<Pick<RobotsConfig, 'disallow' | 'sitemapUrl'>> = {}): string {\r\n        return new RobotsGenerator({\r\n            allowAI: AI_CRAWLERS.map((b) => b.name),\r\n            blockAI: [],\r\n            disallow: options.disallow ?? DEFAULT_DISALLOW,\r\n            sitemapUrl: options.sitemapUrl,\r\n        }).generate()\r\n    }\r\n\r\n    /**\r\n     * Returns a robots.txt that blocks training bots (CCBot, GPTBot, etc.)\r\n     * but allows search/indexing bots.\r\n     */\r\n    static blockTraining(options: Partial<Pick<RobotsConfig, 'disallow' | 'sitemapUrl'>> = {}): string {\r\n        const trainingBots = AI_CRAWLERS\r\n            .filter((b) => b.purpose === 'training')\r\n            .map((b) => b.name)\r\n\r\n        const searchBots = AI_CRAWLERS\r\n            .filter((b) => b.purpose !== 'training')\r\n            .map((b) => b.name)\r\n\r\n        return new RobotsGenerator({\r\n            allowAI: searchBots,\r\n            blockAI: trainingBots,\r\n            disallow: options.disallow ?? DEFAULT_DISALLOW,\r\n            sitemapUrl: options.sitemapUrl,\r\n        }).generate()\r\n    }\r\n}\r\n","// ============================================================\r\n// llms.txt Generator\r\n// Feature 2b: Generate the emerging llms.txt standard (2026)\r\n// Spec: https://llmstxt.org\r\n// ============================================================\r\n\r\nimport type { LLMSConfig, LLMSPage } from '../types'\r\n\r\n/**\r\n * LLMSTextGenerator\r\n *\r\n * Generates an llms.txt file  a plain-text index of your site\r\n * designed specifically for Large Language Models to understand\r\n * your content without crawling every page.\r\n *\r\n * @example\r\n * ```ts\r\n * import { LLMSTextGenerator } from 'ai-visibility'\r\n * import fs from 'fs'\r\n *\r\n * const gen = new LLMSTextGenerator({\r\n *   siteName: 'MyApp',\r\n *   description: 'The best Node.js framework for AI',\r\n *   baseUrl: 'https://myapp.com',\r\n *   pages: [\r\n *     { url: '/product', title: 'Product', priority: 'high' },\r\n *     { url: '/pricing', title: 'Pricing', summary: '$29/month for Pro plan' },\r\n *     { url: '/docs', title: 'Documentation' },\r\n *   ],\r\n * })\r\n *\r\n * const content = await gen.generate()\r\n * fs.writeFileSync('./public/llms.txt', content)\r\n * ```\r\n */\r\nexport class LLMSTextGenerator {\r\n    private config: LLMSConfig\r\n\r\n    constructor(config: LLMSConfig) {\r\n        this.config = config\r\n    }\r\n\r\n    /**\r\n     * Generate the llms.txt content.\r\n     * If autoSummarize is true and a page has no summary, it will attempt\r\n     * to fetch the page and extract the first meaningful paragraph.\r\n     */\r\n    async generate(): Promise<string> {\r\n        const { siteName, description, baseUrl, pages, contact } = this.config\r\n        const lines: string[] = []\r\n\r\n        // Header\r\n        lines.push(`# ${siteName}`)\r\n        lines.push('')\r\n        lines.push(`> ${description}`)\r\n        lines.push('')\r\n\r\n        // Contact / author block\r\n        if (contact) {\r\n            lines.push('## About')\r\n            lines.push('')\r\n            if (contact.email) lines.push(`- Email: ${contact.email}`)\r\n            if (contact.twitter) lines.push(`- Twitter: ${contact.twitter}`)\r\n            if (contact.github) lines.push(`- GitHub: ${contact.github}`)\r\n            lines.push('')\r\n        }\r\n\r\n        // Sort pages: high priority first\r\n        const sorted = [...pages].sort((a, b) => {\r\n            const order = { high: 0, medium: 1, low: 2, undefined: 1 }\r\n            return (order[a.priority ?? 'medium'] ?? 1) - (order[b.priority ?? 'medium'] ?? 1)\r\n        })\r\n\r\n        // High priority pages\r\n        const highPriority = sorted.filter((p) => p.priority === 'high')\r\n        const rest = sorted.filter((p) => p.priority !== 'high')\r\n\r\n        if (highPriority.length > 0) {\r\n            lines.push('## Key Resources')\r\n            lines.push('')\r\n            for (const page of highPriority) {\r\n                await this.appendPage(lines, page, baseUrl)\r\n            }\r\n        }\r\n\r\n        if (rest.length > 0) {\r\n            lines.push('## All Pages')\r\n            lines.push('')\r\n            for (const page of rest) {\r\n                await this.appendPage(lines, page, baseUrl)\r\n            }\r\n        }\r\n\r\n        // Footer\r\n        lines.push('---')\r\n        lines.push(`Generated by ai-visibility  https://github.com/yourusername/ai-visibility`)\r\n\r\n        return lines.join('\\n')\r\n    }\r\n\r\n    private async appendPage(\r\n        lines: string[],\r\n        page: LLMSPage,\r\n        baseUrl?: string\r\n    ): Promise<void> {\r\n        const fullUrl = this.resolveUrl(page.url, baseUrl)\r\n\r\n        lines.push(`### ${page.title}`)\r\n        lines.push(`URL: ${fullUrl}`)\r\n\r\n        let summary = page.summary\r\n\r\n        if (!summary && this.config.autoSummarize) {\r\n            summary = await this.fetchSummary(fullUrl)\r\n        }\r\n\r\n        if (summary) {\r\n            lines.push('')\r\n            lines.push(summary)\r\n        }\r\n\r\n        lines.push('')\r\n    }\r\n\r\n    private resolveUrl(url: string, baseUrl?: string): string {\r\n        if (url.startsWith('http://') || url.startsWith('https://')) {\r\n            return url\r\n        }\r\n        if (baseUrl) {\r\n            return `${baseUrl.replace(/\\/$/, '')}${url.startsWith('/') ? url : `/${url}`}`\r\n        }\r\n        return url\r\n    }\r\n\r\n    /**\r\n     * Attempt to fetch a live URL and extract its first meaningful paragraph.\r\n     * Falls back gracefully if fetch fails.\r\n     */\r\n    private async fetchSummary(url: string): Promise<string> {\r\n        try {\r\n            const response = await fetch(url, {\r\n                headers: { 'User-Agent': 'ai-visibility/0.1.0 (llms.txt generator)' },\r\n                signal: AbortSignal.timeout(5000),\r\n            })\r\n\r\n            if (!response.ok) return ''\r\n\r\n            const html = await response.text()\r\n\r\n            // Simple extraction: find first <p> in main content areas\r\n            const match = html.match(\r\n                /<(?:article|main|\\.content)[^>]*>[\\s\\S]*?<p[^>]*>([\\s\\S]*?)<\\/p>/i\r\n            ) ?? html.match(/<p[^>]*>([\\s\\S]*?)<\\/p>/i)\r\n\r\n            if (match) {\r\n                // Strip HTML tags and trim\r\n                const text = match[1]\r\n                    .replace(/<[^>]+>/g, '')\r\n                    .replace(/\\s+/g, ' ')\r\n                    .trim()\r\n                return text.slice(0, 300) + (text.length > 300 ? '...' : '')\r\n            }\r\n\r\n            return ''\r\n        } catch {\r\n            return ''\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Generate a minimal llms.txt with just URLs and titles.\r\n     * Useful for large sites where you don't want summaries.\r\n     */\r\n    static minimal(config: LLMSConfig): string {\r\n        const lines: string[] = []\r\n        lines.push(`# ${config.siteName}`)\r\n        lines.push('')\r\n        lines.push(`> ${config.description}`)\r\n        lines.push('')\r\n        lines.push('## Pages')\r\n        lines.push('')\r\n\r\n        for (const page of config.pages) {\r\n            const base = config.baseUrl?.replace(/\\/$/, '') ?? ''\r\n            const url = page.url.startsWith('http') ? page.url : `${base}${page.url}`\r\n            lines.push(`- [${page.title}](${url})`)\r\n        }\r\n\r\n        return lines.join('\\n')\r\n    }\r\n}\r\n","// ============================================================\r\n// Schema Builder\r\n// Feature 3: Auto-generate JSON-LD structured data\r\n// ============================================================\r\n\r\nimport * as cheerio from 'cheerio'\r\nimport type {\r\n    FAQItem,\r\n    ProductSchemaData,\r\n    ArticleSchemaData,\r\n    OrganizationSchemaData,\r\n    PersonSchemaData,\r\n} from '../types'\r\n\r\ntype SchemaObject = Record<string, unknown>\r\n\r\n/**\r\n * SchemaBuilder\r\n *\r\n * Generates valid JSON-LD structured data (schema.org) for AI and search engines.\r\n * Supports FAQ, Product, Article, Organization, Person schemas.\r\n * Can auto-detect schema type from raw HTML.\r\n *\r\n * @example\r\n * ```ts\r\n * import { SchemaBuilder } from 'ai-visibility'\r\n *\r\n * // Manual FAQ schema\r\n * const schema = SchemaBuilder.faq([\r\n *   { q: 'What is this?', a: 'An AI visibility tool.' },\r\n * ])\r\n *\r\n * // Auto-detect from HTML\r\n * const schema = await SchemaBuilder.fromHTML(htmlString)\r\n *\r\n * // Render as <script> tag\r\n * const tag = SchemaBuilder.toScriptTag(schema)\r\n * ```\r\n */\r\nexport class SchemaBuilder {\r\n    // ---- FAQ ----\r\n\r\n    static faq(items: FAQItem[]): SchemaObject {\r\n        return {\r\n            '@context': 'https://schema.org',\r\n            '@type': 'FAQPage',\r\n            mainEntity: items.map((item) => ({\r\n                '@type': 'Question',\r\n                name: item.q,\r\n                acceptedAnswer: {\r\n                    '@type': 'Answer',\r\n                    text: item.a,\r\n                },\r\n            })),\r\n        }\r\n    }\r\n\r\n    // ---- Product ----\r\n\r\n    static product(data: ProductSchemaData): SchemaObject {\r\n        const schema: SchemaObject = {\r\n            '@context': 'https://schema.org',\r\n            '@type': 'Product',\r\n            name: data.name,\r\n            offers: {\r\n                '@type': 'Offer',\r\n                price: data.price,\r\n                priceCurrency: data.currency ?? 'USD',\r\n                availability: `https://schema.org/${data.availability ?? 'InStock'}`,\r\n            },\r\n        }\r\n\r\n        if (data.description) schema['description'] = data.description\r\n        if (data.url) schema['url'] = data.url\r\n        if (data.image) schema['image'] = data.image\r\n        if (data.brand) schema['brand'] = { '@type': 'Brand', name: data.brand }\r\n        if (data.features?.length) schema['additionalProperty'] = data.features.map((f) => ({\r\n            '@type': 'PropertyValue',\r\n            name: 'feature',\r\n            value: f,\r\n        }))\r\n        if (data.author) {\r\n            schema['author'] = {\r\n                '@type': 'Person',\r\n                name: data.author.name,\r\n                ...(data.author.jobTitle && { jobTitle: data.author.jobTitle }),\r\n            }\r\n        }\r\n\r\n        return schema\r\n    }\r\n\r\n    // ---- Article ----\r\n\r\n    static article(data: ArticleSchemaData): SchemaObject {\r\n        const schema: SchemaObject = {\r\n            '@context': 'https://schema.org',\r\n            '@type': 'Article',\r\n            headline: data.headline,\r\n        }\r\n\r\n        if (data.description) schema['description'] = data.description\r\n        if (data.url) schema['url'] = data.url\r\n        if (data.image) schema['image'] = data.image\r\n        if (data.publishedDate) schema['datePublished'] = data.publishedDate\r\n        if (data.modifiedDate) schema['dateModified'] = data.modifiedDate\r\n        if (data.keywords?.length) schema['keywords'] = data.keywords.join(', ')\r\n\r\n        if (data.author) {\r\n            schema['author'] = { '@type': 'Person', name: data.author }\r\n        }\r\n        if (data.publisher) {\r\n            schema['publisher'] = {\r\n                '@type': 'Organization',\r\n                name: data.publisher,\r\n            }\r\n        }\r\n\r\n        return schema\r\n    }\r\n\r\n    // ---- Organization ----\r\n\r\n    static organization(data: OrganizationSchemaData): SchemaObject {\r\n        const schema: SchemaObject = {\r\n            '@context': 'https://schema.org',\r\n            '@type': 'Organization',\r\n            name: data.name,\r\n        }\r\n\r\n        if (data.url) schema['url'] = data.url\r\n        if (data.logo) schema['logo'] = data.logo\r\n        if (data.description) schema['description'] = data.description\r\n        if (data.email) schema['email'] = data.email\r\n        if (data.phone) schema['telephone'] = data.phone\r\n        if (data.sameAs?.length) schema['sameAs'] = data.sameAs\r\n        if (data.address) {\r\n            schema['address'] = {\r\n                '@type': 'PostalAddress',\r\n                ...(data.address.street && { streetAddress: data.address.street }),\r\n                ...(data.address.city && { addressLocality: data.address.city }),\r\n                ...(data.address.country && { addressCountry: data.address.country }),\r\n            }\r\n        }\r\n\r\n        return schema\r\n    }\r\n\r\n    // ---- Person ----\r\n\r\n    static person(data: PersonSchemaData): SchemaObject {\r\n        const schema: SchemaObject = {\r\n            '@context': 'https://schema.org',\r\n            '@type': 'Person',\r\n            name: data.name,\r\n        }\r\n\r\n        if (data.jobTitle) schema['jobTitle'] = data.jobTitle\r\n        if (data.url) schema['url'] = data.url\r\n        if (data.image) schema['image'] = data.image\r\n        if (data.email) schema['email'] = data.email\r\n        if (data.description) schema['description'] = data.description\r\n        if (data.sameAs?.length) schema['sameAs'] = data.sameAs\r\n        if (data.worksFor) schema['worksFor'] = { '@type': 'Organization', name: data.worksFor }\r\n\r\n        return schema\r\n    }\r\n\r\n    // ---- Auto-detect from HTML ----\r\n\r\n    /**\r\n     * Analyze HTML content and auto-generate the most appropriate schema.\r\n     * Uses heuristics to detect FAQ, Product, or Article patterns.\r\n     */\r\n    static fromHTML(html: string, hints: { author?: string; publisher?: string } = {}): SchemaObject {\r\n        const $ = cheerio.load(html)\r\n        const type = SchemaBuilder.detectType($)\r\n\r\n        if (type === 'faq') {\r\n            const faqs = SchemaBuilder.extractFAQs($)\r\n            if (faqs.length > 0) return SchemaBuilder.faq(faqs)\r\n        }\r\n\r\n        if (type === 'product') {\r\n            const price = SchemaBuilder.extractPrice($)\r\n            const name = $('h1').first().text().trim() || 'Product'\r\n            return SchemaBuilder.product({\r\n                name,\r\n                price: price ?? 0,\r\n                currency: 'USD',\r\n                features: SchemaBuilder.extractFeatures($),\r\n            })\r\n        }\r\n\r\n        // Default: Article\r\n        const headline = $('h1').first().text().trim() || 'Article'\r\n        const description = $('meta[name=\"description\"]').attr('content') ??\r\n            $('p').first().text().trim().slice(0, 160)\r\n\r\n        return SchemaBuilder.article({\r\n            headline,\r\n            description,\r\n            author: hints.author ?? $('meta[name=\"author\"]').attr('content'),\r\n            publisher: hints.publisher,\r\n        })\r\n    }\r\n\r\n    // ---- Render helpers ----\r\n\r\n    /**\r\n     * Serialize schema to a JSON-LD <script> tag string.\r\n     * Use this to inject into your HTML <head>.\r\n     */\r\n    static toScriptTag(schema: SchemaObject): string {\r\n        return `<script type=\"application/ld+json\">\\n${JSON.stringify(schema, null, 2)}\\n</script>`\r\n    }\r\n\r\n    /**\r\n     * Serialize multiple schemas into a single <script> tag (array).\r\n     */\r\n    static toScriptTagMultiple(schemas: SchemaObject[]): string {\r\n        return `<script type=\"application/ld+json\">\\n${JSON.stringify(schemas, null, 2)}\\n</script>`\r\n    }\r\n\r\n    // ---- Private helpers ----\r\n\r\n    private static detectType($: cheerio.CheerioAPI): 'faq' | 'product' | 'article' {\r\n        const text = $('body').text().toLowerCase()\r\n        const h1 = $('h1').first().text().toLowerCase()\r\n\r\n        // FAQ detection\r\n        if (\r\n            text.includes('frequently asked') ||\r\n            text.includes('faq') ||\r\n            $('dt, .faq, [class*=\"faq\"]').length > 2\r\n        ) {\r\n            return 'faq'\r\n        }\r\n\r\n        // Product detection\r\n        if (\r\n            text.match(/\\$[\\d,]+|[\\d,]+|[\\d,]+/) ||\r\n            text.includes('add to cart') ||\r\n            text.includes('buy now') ||\r\n            h1.includes('pricing') ||\r\n            text.includes('per month') ||\r\n            text.includes('/month')\r\n        ) {\r\n            return 'product'\r\n        }\r\n\r\n        return 'article'\r\n    }\r\n\r\n    private static extractFAQs($: cheerio.CheerioAPI): FAQItem[] {\r\n        const faqs: FAQItem[] = []\r\n\r\n        // Pattern 1: dt/dd pairs\r\n        $('dt').each((_, dt) => {\r\n            const q = $(dt).text().trim()\r\n            const a = $(dt).next('dd').text().trim()\r\n            if (q && a) faqs.push({ q, a })\r\n        })\r\n\r\n        // Pattern 2: heading + paragraph pairs\r\n        if (faqs.length === 0) {\r\n            $('h3, h4').each((_, el) => {\r\n                const q = $(el).text().trim()\r\n                const a = $(el).next('p').text().trim()\r\n                if (q && a && q.includes('?')) faqs.push({ q, a })\r\n            })\r\n        }\r\n\r\n        return faqs\r\n    }\r\n\r\n    private static extractPrice($: cheerio.CheerioAPI): number | null {\r\n        const text = $('body').text()\r\n        const match = text.match(/\\$\\s*([\\d,]+(?:\\.\\d{2})?)/)\r\n        if (match) {\r\n            return parseFloat(match[1].replace(',', ''))\r\n        }\r\n        return null\r\n    }\r\n\r\n    private static extractFeatures($: cheerio.CheerioAPI): string[] {\r\n        const features: string[] = []\r\n\r\n        // Look for feature lists\r\n        $('ul li, ol li').each((_, el) => {\r\n            const text = $(el).text().trim()\r\n            if (text.length > 5 && text.length < 200) {\r\n                features.push(text)\r\n            }\r\n        })\r\n\r\n        return features.slice(0, 10) // Max 10 features\r\n    }\r\n}\r\n","// ============================================================\r\n// Content Analyzer\r\n// Feature 4: Score HTML/Markdown for AI readability\r\n// ============================================================\r\n\r\nimport * as cheerio from 'cheerio'\r\nimport type { AIReadabilityScore, AnalysisIssue, AnalyzerOptions } from '../types'\r\n\r\nconst DEFAULT_OPTIONS: Required<AnalyzerOptions> = {\r\n    checkAnswerPlacement: true,\r\n    checkFactDensity: true,\r\n    checkHeadingStructure: true,\r\n    checkEEAT: true,\r\n    checkSnippability: true,\r\n    checkSchema: true,\r\n}\r\n\r\n/**\r\n * ContentAnalyzer\r\n *\r\n * Analyzes HTML content and scores it for AI readability.\r\n * Returns an overall score (0-100) and specific, actionable issues.\r\n *\r\n * @example\r\n * ```ts\r\n * import { ContentAnalyzer } from 'ai-visibility'\r\n * import fs from 'fs'\r\n *\r\n * const analyzer = new ContentAnalyzer()\r\n * const html = fs.readFileSync('./pages/pricing.html', 'utf-8')\r\n * const result = await analyzer.analyze(html)\r\n *\r\n * console.log(`Score: ${result.overallScore}/100`)\r\n * result.issues.forEach(i => console.log(`[${i.severity}] ${i.message}`))\r\n * ```\r\n */\r\nexport class ContentAnalyzer {\r\n    private options: Required<AnalyzerOptions>\r\n\r\n    constructor(options: AnalyzerOptions = {}) {\r\n        this.options = { ...DEFAULT_OPTIONS, ...options }\r\n    }\r\n\r\n    /**\r\n     * Analyze HTML content and return an AI readability score.\r\n     */\r\n    async analyze(html: string): Promise<AIReadabilityScore> {\r\n        const $ = cheerio.load(html)\r\n        const issues: AnalysisIssue[] = []\r\n        const breakdown: AIReadabilityScore['breakdown'] = {\r\n            answerFrontLoading: 0,\r\n            factDensity: 0,\r\n            headingStructure: 0,\r\n            eeatSignals: 0,\r\n            snippability: 0,\r\n            schemaCoverage: 0,\r\n        }\r\n\r\n        if (this.options.checkAnswerPlacement) {\r\n            const result = this.checkAnswerFrontLoading($)\r\n            breakdown.answerFrontLoading = result.score\r\n            issues.push(...result.issues)\r\n        } else {\r\n            breakdown.answerFrontLoading = 100\r\n        }\r\n\r\n        if (this.options.checkFactDensity) {\r\n            const result = this.checkFactDensity($)\r\n            breakdown.factDensity = result.score\r\n            issues.push(...result.issues)\r\n        } else {\r\n            breakdown.factDensity = 100\r\n        }\r\n\r\n        if (this.options.checkHeadingStructure) {\r\n            const result = this.checkHeadingStructure($)\r\n            breakdown.headingStructure = result.score\r\n            issues.push(...result.issues)\r\n        } else {\r\n            breakdown.headingStructure = 100\r\n        }\r\n\r\n        if (this.options.checkEEAT) {\r\n            const result = this.checkEEAT($)\r\n            breakdown.eeatSignals = result.score\r\n            issues.push(...result.issues)\r\n        } else {\r\n            breakdown.eeatSignals = 100\r\n        }\r\n\r\n        if (this.options.checkSnippability) {\r\n            const result = this.checkSnippability($)\r\n            breakdown.snippability = result.score\r\n            issues.push(...result.issues)\r\n        } else {\r\n            breakdown.snippability = 100\r\n        }\r\n\r\n        if (this.options.checkSchema) {\r\n            const result = this.checkSchemaCoverage($)\r\n            breakdown.schemaCoverage = result.score\r\n            issues.push(...result.issues)\r\n        } else {\r\n            breakdown.schemaCoverage = 100\r\n        }\r\n\r\n        // Weighted average (answer placement and schema are most important)\r\n        const weights = {\r\n            answerFrontLoading: 0.25,\r\n            factDensity: 0.15,\r\n            headingStructure: 0.15,\r\n            eeatSignals: 0.20,\r\n            snippability: 0.10,\r\n            schemaCoverage: 0.15,\r\n        }\r\n\r\n        const overallScore = Math.round(\r\n            Object.entries(breakdown).reduce((sum, [key, score]) => {\r\n                return sum + score * (weights[key as keyof typeof weights] ?? 0)\r\n            }, 0)\r\n        )\r\n\r\n        const recommendations = this.generateRecommendations(breakdown)\r\n\r\n        return {\r\n            overallScore,\r\n            breakdown,\r\n            issues: issues.sort((a, b) => {\r\n                const order = { high: 0, medium: 1, low: 2 }\r\n                return order[a.severity] - order[b.severity]\r\n            }),\r\n            recommendations,\r\n        }\r\n    }\r\n\r\n    // ---- Individual Checks ----\r\n\r\n    private checkAnswerFrontLoading($: cheerio.CheerioAPI): { score: number; issues: AnalysisIssue[] } {\r\n        const issues: AnalysisIssue[] = []\r\n        const h1 = $('h1').first()\r\n\r\n        if (!h1.length) {\r\n            issues.push({\r\n                type: 'answer-placement',\r\n                severity: 'high',\r\n                message: 'No H1 tag found on the page',\r\n                fix: 'Add a clear, descriptive H1 tag that states what this page is about',\r\n            })\r\n            return { score: 0, issues }\r\n        }\r\n\r\n        // Find the first paragraph in the main content area\r\n        const mainContent = $('main, article, [role=\"main\"], .content, #content').first()\r\n        const firstP = mainContent.length\r\n            ? mainContent.find('p').first()\r\n            : $('h1').first().nextAll('p').first()\r\n\r\n        const firstPText = firstP.text().trim()\r\n\r\n        if (!firstPText || firstPText.length < 30) {\r\n            issues.push({\r\n                type: 'answer-placement',\r\n                severity: 'high',\r\n                message: 'No substantive paragraph found after H1',\r\n                fix: 'Add a clear, direct answer or description in the first paragraph immediately after your H1',\r\n            })\r\n            return { score: 20, issues }\r\n        }\r\n\r\n        // Check if the first paragraph directly answers the H1\r\n        const h1Text = h1.text().toLowerCase()\r\n        const answerWords = ['is', 'are', 'helps', 'provides', 'enables', 'allows', 'lets', 'gives', 'makes']\r\n        const hasDirectAnswer = answerWords.some((w) => firstPText.toLowerCase().includes(w))\r\n\r\n        // Check if answer is within first 20% of total content\r\n        const allText = $('body').text()\r\n        const firstPPosition = allText.indexOf(firstPText.slice(0, 50))\r\n        const positionRatio = firstPPosition / allText.length\r\n\r\n        if (!hasDirectAnswer) {\r\n            issues.push({\r\n                type: 'answer-placement',\r\n                severity: 'medium',\r\n                message: 'First paragraph may not directly answer the page topic',\r\n                fix: `Start with a direct statement like \"This page covers...\" or \"${h1Text} is...\"`,\r\n            })\r\n            return { score: 55, issues }\r\n        }\r\n\r\n        if (positionRatio > 0.2) {\r\n            issues.push({\r\n                type: 'answer-placement',\r\n                severity: 'medium',\r\n                message: 'Main answer appears too far down the page',\r\n                fix: 'Move the key answer/description to the very top of the page content',\r\n            })\r\n            return { score: 65, issues }\r\n        }\r\n\r\n        return { score: 95, issues }\r\n    }\r\n\r\n    private checkFactDensity($: cheerio.CheerioAPI): { score: number; issues: AnalysisIssue[] } {\r\n        const issues: AnalysisIssue[] = []\r\n        const paragraphs = $('p')\r\n        let totalWords = 0\r\n        let verifiableFacts = 0\r\n\r\n        paragraphs.each((_, el) => {\r\n            const text = $(el).text()\r\n            const words = text.split(/\\s+/).filter(Boolean).length\r\n            totalWords += words\r\n\r\n            // Heuristic: numbers, percentages, dates, named entities\r\n            const facts = (\r\n                text.match(\r\n                    /\\b\\d+(?:\\.\\d+)?%|\\b\\d{4}\\b|\\b\\d+(?:,\\d{3})*(?:\\.\\d+)?\\s*(?:million|billion|thousand|k|m|b)?\\b|\\b(?:january|february|march|april|may|june|july|august|september|october|november|december)\\b/gi\r\n                ) ?? []\r\n            ).length\r\n            verifiableFacts += facts\r\n        })\r\n\r\n        if (totalWords === 0) {\r\n            return { score: 0, issues: [{ type: 'fact-density', severity: 'high', message: 'No paragraph content found', fix: 'Add substantive text content to the page' }] }\r\n        }\r\n\r\n        const factsPerHundred = (verifiableFacts / totalWords) * 100\r\n\r\n        if (factsPerHundred < 2) {\r\n            issues.push({\r\n                type: 'fact-density',\r\n                severity: 'high',\r\n                message: `Very low fact density: ${factsPerHundred.toFixed(1)} facts per 100 words (target: 4-6)`,\r\n                fix: 'Add specific numbers, dates, statistics, or measurable claims to support your content',\r\n            })\r\n            return { score: 25, issues }\r\n        }\r\n\r\n        if (factsPerHundred < 4) {\r\n            issues.push({\r\n                type: 'fact-density',\r\n                severity: 'medium',\r\n                message: `Below-target fact density: ${factsPerHundred.toFixed(1)} facts per 100 words (target: 4-6)`,\r\n                fix: 'Include more specific data points, percentages, or concrete examples',\r\n            })\r\n            return { score: 60, issues }\r\n        }\r\n\r\n        if (factsPerHundred > 10) {\r\n            issues.push({\r\n                type: 'fact-density',\r\n                severity: 'low',\r\n                message: 'Very high fact density  content may feel dense or list-heavy',\r\n                fix: 'Add explanatory prose between data points to improve readability',\r\n            })\r\n            return { score: 75, issues }\r\n        }\r\n\r\n        return { score: 95, issues }\r\n    }\r\n\r\n    private checkHeadingStructure($: cheerio.CheerioAPI): { score: number; issues: AnalysisIssue[] } {\r\n        const issues: AnalysisIssue[] = []\r\n        let score = 100\r\n\r\n        const h1Count = $('h1').length\r\n        const h2s = $('h2')\r\n        const h3s = $('h3')\r\n\r\n        // Must have exactly one H1\r\n        if (h1Count === 0) {\r\n            issues.push({ type: 'heading-structure', severity: 'high', message: 'Missing H1 tag', fix: 'Add exactly one H1 tag as the main page title' })\r\n            score -= 40\r\n        } else if (h1Count > 1) {\r\n            issues.push({ type: 'heading-structure', severity: 'medium', message: `Multiple H1 tags found (${h1Count})`, fix: 'Use only one H1 per page. Demote additional H1s to H2' })\r\n            score -= 20\r\n        }\r\n\r\n        // Check H3 without H2\r\n        if (h3s.length > 0 && h2s.length === 0) {\r\n            issues.push({ type: 'heading-structure', severity: 'medium', message: 'H3 tags used without any H2 tags', fix: 'Add H2 headings to create proper hierarchy: H1  H2  H3' })\r\n            score -= 20\r\n        }\r\n\r\n        // Check for skipped levels (H1  H3 without H2)\r\n        let lastLevel = 1\r\n        $('h1, h2, h3, h4').each((_, el) => {\r\n            const level = parseInt(el.tagName.replace('h', ''), 10)\r\n            if (level > lastLevel + 1) {\r\n                issues.push({\r\n                    type: 'heading-structure',\r\n                    severity: 'low',\r\n                    message: `Heading level skipped: H${lastLevel}  H${level}`,\r\n                    fix: `Add an H${lastLevel + 1} between your H${lastLevel} and H${level}`,\r\n                })\r\n                score -= 10\r\n            }\r\n            lastLevel = level\r\n        })\r\n\r\n        // Check for empty headings\r\n        $('h1, h2, h3').each((_, el) => {\r\n            if (!$(el).text().trim()) {\r\n                issues.push({ type: 'heading-structure', severity: 'medium', message: 'Empty heading tag found', fix: 'Remove or fill empty heading tags' })\r\n                score -= 10\r\n            }\r\n        })\r\n\r\n        return { score: Math.max(0, score), issues }\r\n    }\r\n\r\n    private checkEEAT($: cheerio.CheerioAPI): { score: number; issues: AnalysisIssue[] } {\r\n        const issues: AnalysisIssue[] = []\r\n        let score = 0\r\n        const MAX = 100\r\n\r\n        // Author info (25 pts)\r\n        const hasAuthor =\r\n            $('[itemtype*=\"Person\"], [itemprop=\"author\"], meta[name=\"author\"], .author, [rel=\"author\"]').length > 0 ||\r\n            $('body').text().match(/written by|by [A-Z][a-z]+ [A-Z][a-z]+/i) !== null\r\n\r\n        if (hasAuthor) {\r\n            score += 25\r\n        } else {\r\n            issues.push({\r\n                type: 'eeat',\r\n                severity: 'medium',\r\n                message: 'No author information detected',\r\n                fix: 'Add author name with a link to their bio or use schema.org Person markup',\r\n            })\r\n        }\r\n\r\n        // Organization info (25 pts)\r\n        const hasOrg =\r\n            $('[itemtype*=\"Organization\"], [itemprop=\"publisher\"]').length > 0 ||\r\n            $('meta[property=\"og:site_name\"]').length > 0\r\n\r\n        if (hasOrg) {\r\n            score += 25\r\n        } else {\r\n            issues.push({\r\n                type: 'eeat',\r\n                severity: 'low',\r\n                message: 'No organization/publisher markup found',\r\n                fix: 'Add Organization schema or og:site_name meta tag',\r\n            })\r\n        }\r\n\r\n        // Contact info (25 pts)\r\n        const hasContact =\r\n            $('a[href^=\"mailto:\"], a[href^=\"tel:\"], [role=\"contentinfo\"], footer').length > 0\r\n\r\n        if (hasContact) {\r\n            score += 25\r\n        } else {\r\n            issues.push({\r\n                type: 'eeat',\r\n                severity: 'medium',\r\n                message: 'No contact information found',\r\n                fix: 'Add email, phone, or contact page link  AI models use this as a trust signal',\r\n            })\r\n        }\r\n\r\n        // Trust signals (25 pts)\r\n        const bodyText = $('body').text()\r\n        const trustSignals = [\r\n            /years?\\s+(?:of\\s+)?experience/i,\r\n            /certified|certification/i,\r\n            /award|recognized/i,\r\n            /published|featured in/i,\r\n            /trusted by|used by/i,\r\n            /\\d+\\s*(?:k|,000)?\\s*(?:users|customers|companies)/i,\r\n        ]\r\n\r\n        const hasTrustSignals = trustSignals.some((pattern) => pattern.test(bodyText))\r\n\r\n        if (hasTrustSignals) {\r\n            score += 25\r\n        } else {\r\n            issues.push({\r\n                type: 'eeat',\r\n                severity: 'low',\r\n                message: 'No expertise/trust signals detected',\r\n                fix: 'Add credentials, years of experience, customer counts, or press mentions',\r\n            })\r\n        }\r\n\r\n        return { score: Math.min(score, MAX), issues }\r\n    }\r\n\r\n    private checkSnippability($: cheerio.CheerioAPI): { score: number; issues: AnalysisIssue[] } {\r\n        const issues: AnalysisIssue[] = []\r\n        const headings = $('h2, h3')\r\n\r\n        if (headings.length === 0) {\r\n            issues.push({\r\n                type: 'snippability',\r\n                severity: 'medium',\r\n                message: 'No H2/H3 subheadings found',\r\n                fix: 'Break content into sections with descriptive H2/H3 headings so AI can extract individual sections',\r\n            })\r\n            return { score: 30, issues }\r\n        }\r\n\r\n        let snippableCount = 0\r\n        let totalChecked = 0\r\n\r\n        headings.each((_, el) => {\r\n            totalChecked++\r\n            const nextEl = $(el).next()\r\n            const nextText = nextEl.text().trim()\r\n\r\n            // A section is \"snippable\" if it has a substantive paragraph following it\r\n            if (nextText.length >= 80) {\r\n                snippableCount++\r\n            } else {\r\n                issues.push({\r\n                    type: 'snippability',\r\n                    severity: 'low',\r\n                    message: `Section \"${$(el).text().trim()}\" has insufficient content below it`,\r\n                    fix: 'Add at least 2-3 sentences of context below each heading so the section can stand alone',\r\n                })\r\n            }\r\n        })\r\n\r\n        const ratio = snippableCount / Math.max(totalChecked, 1)\r\n        const score = Math.round(ratio * 100)\r\n\r\n        return { score, issues }\r\n    }\r\n\r\n    private checkSchemaCoverage($: cheerio.CheerioAPI): { score: number; issues: AnalysisIssue[] } {\r\n        const issues: AnalysisIssue[] = []\r\n        const schemaScripts = $('script[type=\"application/ld+json\"]')\r\n\r\n        if (schemaScripts.length === 0) {\r\n            issues.push({\r\n                type: 'schema',\r\n                severity: 'high',\r\n                message: 'No JSON-LD structured data found',\r\n                fix: 'Add JSON-LD schema markup using SchemaBuilder from ai-visibility',\r\n            })\r\n            return { score: 0, issues }\r\n        }\r\n\r\n        let validSchemas = 0\r\n        schemaScripts.each((_, el) => {\r\n            try {\r\n                const json = JSON.parse($(el).html() ?? '')\r\n                if (json['@context'] && json['@type']) validSchemas++\r\n            } catch {\r\n                issues.push({\r\n                    type: 'schema',\r\n                    severity: 'medium',\r\n                    message: 'Invalid JSON-LD schema found (parse error)',\r\n                    fix: 'Validate your JSON-LD using schema.org validator or use SchemaBuilder',\r\n                })\r\n            }\r\n        })\r\n\r\n        if (validSchemas === 0) {\r\n            return { score: 10, issues }\r\n        }\r\n\r\n        // Check for recommended schema types\r\n        const schemaText = $('script[type=\"application/ld+json\"]').text()\r\n        const hasFAQ = schemaText.includes('\"FAQPage\"')\r\n        const hasOrg = schemaText.includes('\"Organization\"')\r\n\r\n        if (!hasFAQ) {\r\n            issues.push({\r\n                type: 'schema',\r\n                severity: 'low',\r\n                message: 'No FAQPage schema found',\r\n                fix: 'Add FAQ schema to help AI models extract Q&A content from your page',\r\n            })\r\n        }\r\n\r\n        if (!hasOrg) {\r\n            issues.push({\r\n                type: 'schema',\r\n                severity: 'low',\r\n                message: 'No Organization schema found',\r\n                fix: 'Add Organization schema to establish E-E-A-T signals for AI models',\r\n            })\r\n        }\r\n\r\n        const score = hasFAQ && hasOrg ? 100 : hasFAQ || hasOrg ? 75 : 50\r\n        return { score, issues }\r\n    }\r\n\r\n    // ---- Recommendations ----\r\n\r\n    private generateRecommendations(breakdown: AIReadabilityScore['breakdown']): string[] {\r\n        const recs: string[] = []\r\n\r\n        if (breakdown.answerFrontLoading < 70) {\r\n            recs.push(' Front-load your answers: AI models prioritize content in the first 20% of a section')\r\n        }\r\n        if (breakdown.factDensity < 60) {\r\n            recs.push(' Add more data: Include specific numbers, dates, and statistics to improve citability')\r\n        }\r\n        if (breakdown.headingStructure < 80) {\r\n            recs.push(' Fix heading hierarchy: Use H1  H2  H3 consistently for better content parsing')\r\n        }\r\n        if (breakdown.eeatSignals < 60) {\r\n            recs.push(' Boost E-E-A-T: Add author credentials, company info, and trust signals')\r\n        }\r\n        if (breakdown.snippability < 70) {\r\n            recs.push(' Improve snippability: Each section should be self-contained and informative')\r\n        }\r\n        if (breakdown.schemaCoverage < 50) {\r\n            recs.push(' Add structured data: Use SchemaBuilder to add JSON-LD markup for AI understanding')\r\n        }\r\n\r\n        if (recs.length === 0) {\r\n            recs.push(' Great job! Your content is well-optimized for AI visibility')\r\n        }\r\n\r\n        return recs\r\n    }\r\n}\r\n","// ============================================================\r\n// AI Visitor Logger / Crawler Monitor\r\n// Feature 5: Track AI crawler visits with local file storage\r\n// ============================================================\r\n\r\nimport fs from 'fs'\r\nimport path from 'path'\r\nimport type { Request, Response, NextFunction } from 'express'\r\nimport { detectBot } from '../data/crawlers'\r\nimport type { CrawlerLog, LoggerConfig } from '../types'\r\n\r\nconst DEFAULT_LOG_PATH = './logs/ai-crawler.json'\r\nconst DEFAULT_MAX_MEMORY = 1000\r\n\r\n/**\r\n * AIVisitorLogger\r\n *\r\n * Middleware that logs every AI crawler visit with timing, status, and URL.\r\n * Supports in-memory and file-based storage.\r\n *\r\n * @example\r\n * ```ts\r\n * import express from 'express'\r\n * import { AIVisitorLogger } from 'ai-visibility'\r\n *\r\n * const app = express()\r\n * const logger = new AIVisitorLogger({ storage: 'file' })\r\n * app.use(logger.middleware())\r\n *\r\n * // Later: query logs\r\n * const stats = logger.getStats()\r\n * const recent = logger.getLogs({ days: 7 })\r\n * ```\r\n */\r\nexport class AIVisitorLogger {\r\n    private config: Required<LoggerConfig>\r\n    private memoryLogs: CrawlerLog[] = []\r\n\r\n    constructor(config: LoggerConfig = {}) {\r\n        this.config = {\r\n            storage: config.storage ?? 'both',\r\n            logFilePath: config.logFilePath ?? DEFAULT_LOG_PATH,\r\n            trackCrawlers: config.trackCrawlers ?? [],\r\n            maxMemoryEntries: config.maxMemoryEntries ?? DEFAULT_MAX_MEMORY,\r\n        }\r\n\r\n        // Ensure log directory exists\r\n        if (this.config.storage !== 'memory') {\r\n            const dir = path.dirname(this.config.logFilePath)\r\n            if (!fs.existsSync(dir)) {\r\n                fs.mkdirSync(dir, { recursive: true })\r\n            }\r\n            // Initialize empty log file if it doesn't exist\r\n            if (!fs.existsSync(this.config.logFilePath)) {\r\n                fs.writeFileSync(this.config.logFilePath, JSON.stringify([], null, 2))\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Express middleware that logs AI crawler visits.\r\n     */\r\n    middleware() {\r\n        return (req: Request, res: Response, next: NextFunction): void => {\r\n            const userAgent = req.headers['user-agent'] ?? ''\r\n            const botInfo = detectBot(userAgent)\r\n\r\n            if (!botInfo) {\r\n                next()\r\n                return\r\n            }\r\n\r\n            // Filter by tracked crawlers if specified\r\n            if (\r\n                this.config.trackCrawlers.length > 0 &&\r\n                !this.config.trackCrawlers.includes(botInfo.name)\r\n            ) {\r\n                next()\r\n                return\r\n            }\r\n\r\n            const startTime = Date.now()\r\n\r\n            res.on('finish', () => {\r\n                const log: CrawlerLog = {\r\n                    botName: botInfo.name,\r\n                    company: botInfo.company,\r\n                    url: req.url,\r\n                    method: req.method,\r\n                    timestamp: new Date().toISOString(),\r\n                    statusCode: res.statusCode,\r\n                    responseTimeMs: Date.now() - startTime,\r\n                    userAgent,\r\n                    ip: req.ip ?? req.socket.remoteAddress,\r\n                }\r\n\r\n                this.saveLog(log)\r\n            })\r\n\r\n            next()\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Manually log a crawler visit (useful for non-Express frameworks).\r\n     */\r\n    log(entry: CrawlerLog): void {\r\n        this.saveLog(entry)\r\n    }\r\n\r\n    /**\r\n     * Get all logs, optionally filtered.\r\n     */\r\n    getLogs(filter?: { botName?: string; days?: number; url?: string }): CrawlerLog[] {\r\n        const logs = this.readAllLogs()\r\n\r\n        return logs.filter((log) => {\r\n            if (filter?.botName && log.botName !== filter.botName) return false\r\n            if (filter?.url && !log.url.includes(filter.url)) return false\r\n            if (filter?.days) {\r\n                const cutoff = new Date()\r\n                cutoff.setDate(cutoff.getDate() - filter.days)\r\n                if (new Date(log.timestamp) < cutoff) return false\r\n            }\r\n            return true\r\n        })\r\n    }\r\n\r\n    /**\r\n     * Get aggregated statistics per bot.\r\n     */\r\n    getStats(days?: number): Record<string, BotStatsSerialized> {\r\n        const logs = this.getLogs(days ? { days } : undefined)\r\n        const stats: Record<string, BotStatsInternal> = {}\r\n\r\n        for (const log of logs) {\r\n            if (!stats[log.botName]) {\r\n                stats[log.botName] = {\r\n                    botName: log.botName,\r\n                    company: log.company,\r\n                    totalVisits: 0,\r\n                    uniqueUrls: new Set(),\r\n                    lastSeen: log.timestamp,\r\n                    avgResponseTimeMs: 0,\r\n                    successRate: 0,\r\n                    successCount: 0,\r\n                }\r\n            }\r\n\r\n            const s = stats[log.botName]!\r\n            s.totalVisits++\r\n            s.uniqueUrls.add(log.url)\r\n            if (new Date(log.timestamp) > new Date(s.lastSeen)) {\r\n                s.lastSeen = log.timestamp\r\n            }\r\n            s.avgResponseTimeMs =\r\n                (s.avgResponseTimeMs * (s.totalVisits - 1) + log.responseTimeMs) / s.totalVisits\r\n\r\n            if (log.statusCode >= 200 && log.statusCode < 400) {\r\n                s.successCount++\r\n            }\r\n            s.successRate = Math.round((s.successCount / s.totalVisits) * 100)\r\n        }\r\n\r\n        // Convert Set to count for serialization\r\n        const result: Record<string, BotStatsSerialized> = {}\r\n        for (const [key, v] of Object.entries(stats)) {\r\n            result[key] = {\r\n                botName: v.botName,\r\n                company: v.company,\r\n                totalVisits: v.totalVisits,\r\n                uniqueUrlCount: v.uniqueUrls.size,\r\n                lastSeen: v.lastSeen,\r\n                avgResponseTimeMs: Math.round(v.avgResponseTimeMs),\r\n                successRate: v.successRate,\r\n                successCount: v.successCount,\r\n            }\r\n        }\r\n        return result\r\n    }\r\n\r\n    /**\r\n     * Clear all logs.\r\n     */\r\n    clearLogs(): void {\r\n        this.memoryLogs = []\r\n        if (this.config.storage !== 'memory') {\r\n            fs.writeFileSync(this.config.logFilePath, JSON.stringify([], null, 2))\r\n        }\r\n    }\r\n\r\n    // ---- Private ----\r\n\r\n    private saveLog(log: CrawlerLog): void {\r\n        // Memory storage\r\n        if (this.config.storage === 'memory' || this.config.storage === 'both') {\r\n            this.memoryLogs.push(log)\r\n            // Trim if over limit\r\n            if (this.memoryLogs.length > this.config.maxMemoryEntries) {\r\n                this.memoryLogs = this.memoryLogs.slice(-this.config.maxMemoryEntries)\r\n            }\r\n        }\r\n\r\n        // File storage\r\n        if (this.config.storage === 'file' || this.config.storage === 'both') {\r\n            try {\r\n                const existing = this.readFromFile()\r\n                existing.push(log)\r\n                fs.writeFileSync(this.config.logFilePath, JSON.stringify(existing, null, 2))\r\n            } catch (err) {\r\n                console.error('[ai-visibility] Failed to write crawler log:', err)\r\n            }\r\n        }\r\n    }\r\n\r\n    private readAllLogs(): CrawlerLog[] {\r\n        if (this.config.storage === 'memory') {\r\n            return [...this.memoryLogs]\r\n        }\r\n        if (this.config.storage === 'file') {\r\n            return this.readFromFile()\r\n        }\r\n        // 'both': prefer memory (faster), fall back to file\r\n        return this.memoryLogs.length > 0 ? [...this.memoryLogs] : this.readFromFile()\r\n    }\r\n\r\n    private readFromFile(): CrawlerLog[] {\r\n        try {\r\n            if (!fs.existsSync(this.config.logFilePath)) return []\r\n            const raw = fs.readFileSync(this.config.logFilePath, 'utf-8')\r\n            return JSON.parse(raw) as CrawlerLog[]\r\n        } catch {\r\n            return []\r\n        }\r\n    }\r\n}\r\n\r\n// ---- Internal types ----\r\ninterface BotStatsInternal {\r\n    botName: string\r\n    company: string\r\n    totalVisits: number\r\n    uniqueUrls: Set<string>\r\n    lastSeen: string\r\n    avgResponseTimeMs: number\r\n    successRate: number\r\n    successCount: number\r\n}\r\n\r\nexport interface BotStatsSerialized {\r\n    botName: string\r\n    company: string\r\n    totalVisits: number\r\n    uniqueUrlCount: number\r\n    lastSeen: string\r\n    avgResponseTimeMs: number\r\n    successRate: number\r\n    successCount: number\r\n}\r\n"]}